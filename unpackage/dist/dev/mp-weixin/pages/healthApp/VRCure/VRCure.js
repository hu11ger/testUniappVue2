(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/healthApp/VRCure/VRCure"],{118:function(e,t,n){"use strict";(function(e,t){var a=n(4);n(26),n(27),n(28);a(n(25));var o=a(n(119));e.__webpack_require_UNI_MP_PLUGIN__=n,t(o.default)}).call(this,n(1)["default"],n(2)["createPage"])},119:function(e,t,n){"use strict";n.r(t);var a=n(120),o=n(122);for(var s in o)["default"].indexOf(s)<0&&function(e){n.d(t,e,(function(){return o[e]}))}(s);n(124),n(126);var i,r=n(50),c=Object(r["default"])(o["default"],a["render"],a["staticRenderFns"],!1,null,"d5afc308",null,!1,a["components"],i);c.options.__file="pages/healthApp/VRCure/VRCure.vue",t["default"]=c.exports},120:function(e,t,n){"use strict";n.r(t);var a=n(121);n.d(t,"render",(function(){return a["render"]})),n.d(t,"staticRenderFns",(function(){return a["staticRenderFns"]})),n.d(t,"recyclableRender",(function(){return a["recyclableRender"]})),n.d(t,"components",(function(){return a["components"]}))},121:function(e,t,n){"use strict";var a;n.r(t),n.d(t,"render",(function(){return o})),n.d(t,"staticRenderFns",(function(){return i})),n.d(t,"recyclableRender",(function(){return s})),n.d(t,"components",(function(){return a}));try{a={uniPopup:function(){return n.e("uni_modules/uni-popup/components/uni-popup/uni-popup").then(n.bind(null,1428))},uniPopupDialog:function(){return Promise.all([n.e("common/vendor"),n.e("uni_modules/uni-popup/components/uni-popup-dialog/uni-popup-dialog")]).then(n.bind(null,1435))},uTabbar:function(){return n.e("uview-ui/components/u-tabbar/u-tabbar").then(n.bind(null,1336))},uNavbar:function(){return n.e("uview-ui/components/u-navbar/u-navbar").then(n.bind(null,1365))},uTabsSwiper:function(){return Promise.all([n.e("common/vendor"),n.e("uview-ui/components/u-tabs-swiper/u-tabs-swiper")]).then(n.bind(null,1372))},uButton:function(){return n.e("uview-ui/components/u-button/u-button").then(n.bind(null,1393))}}}catch(r){if(-1===r.message.indexOf("Cannot find module")||-1===r.message.indexOf(".vue"))throw r;console.error(r.message),console.error("1. 排查组件名称拼写是否正确"),console.error("2. 排查组件是否符合 easycom 规范，文档：https://uniapp.dcloud.net.cn/collocation/pages?id=easycom"),console.error("3. 若组件不符合 easycom 规范，需手动引入，并在 components 中注册该组件")}var o=function(){var e=this,t=e.$createElement,n=(e._self._c,e.imageList.length),a=e.imageList2.length,o=e.imageList3.length;e.$mp.data=Object.assign({},{$root:{g0:n,g1:a,g2:o}})},s=!1,i=[];o._withStripped=!0},122:function(e,t,n){"use strict";n.r(t);var a=n(123),o=n.n(a);for(var s in a)["default"].indexOf(s)<0&&function(e){n.d(t,e,(function(){return a[e]}))}(s);t["default"]=o.a},123:function(e,t,n){"use strict";(function(e,a){var o=n(4);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var s=o(n(29)),i=o(n(32)),r=o(n(11)),c=[["camera"],["album"],["camera","album"]],u=[["compressed"],["original"],["compressed","original"]],l={onLoad:function(){},mounted:function(){this.showAction=!1,this.useSlot=!0,this.rightSlot=!1,this.search=!0,this.slotRight=!1},onUnload:function(){this.imageList=[],this.imageList2=[],this.imageList3=[],this.sourceTypeIndex=2,this.sourceType=["拍照","相册","拍照或相册"],this.sizeTypeIndex=2,this.sizeType=["压缩","原图","压缩或原图"],this.countIndex=8},data:function(){var e;return e={downloadedFilePaths:[],resultIDs:[],meshyLoading:!1,meshyProgress:0,baseUrl:"https://api.meshy.ai/v1/image-to-3d",meshyAPI:"msy_ar8y9bKmstdLwmebSabtqBqnxbiZvsYLyIcX",inputHeader:{Authorization:"Bearer msy_ar8y9bKmstdLwmebSabtqBqnxbiZvsYLyIcX","Content - Type":"application/json"},inputArg:{image_url:"https://mp-4873eed2-c888-469f-becd-e538e287ac05.cdn.bspapp.com/bear.png",enable_pbr:!0},fbxURL:"",fbxLocalPath:"",resultID:"",preUploadImgUrls:[],hairLine:!0,btnType:"primary",btnSize:"default",btnShape:"circle",btnPlain:!1,btnLoading:!1,btnDisabled:!1,hasUserInfo:!1,userInfo:{}},(0,r.default)(e,"btnLoading",!1),(0,r.default)(e,"userPhoneNum",""),(0,r.default)(e,"userTelNum","your_userTelNum"),(0,r.default)(e,"tangiblePicsIndex",1),(0,r.default)(e,"envPicsIndex",1),(0,r.default)(e,"normalPicsIndex",1),(0,r.default)(e,"imageSrc",""),(0,r.default)(e,"title","choose/previewImage"),(0,r.default)(e,"imageList",[]),(0,r.default)(e,"imageList2",[]),(0,r.default)(e,"imageList3",[]),(0,r.default)(e,"sourceTypeIndex",2),(0,r.default)(e,"sourceType",["拍照","相册","拍照或相册"]),(0,r.default)(e,"sizeTypeIndex",2),(0,r.default)(e,"sizeType",["压缩","原图","压缩或原图"]),(0,r.default)(e,"countIndex",8),(0,r.default)(e,"count",[1,2,3,4,5,6,7,8,9]),(0,r.default)(e,"bottomTabCurrent",3),(0,r.default)(e,"show",!0),(0,r.default)(e,"bgColor","#ffffff"),(0,r.default)(e,"borderTop",!0),(0,r.default)(e,"list",[{iconPath:"../../../static/image/navBar/ques.png",selectedIconPath:"../../../static/image/navBar/ques-active.png",text:"SelfRate",pagePath:"pages/healthApp/SelfRatingSelect/SelfRatingSelect",customIcon:!1},{iconPath:"../../../static/image/navBar/bodyData.png",selectedIconPath:"../../../static/image/navBar/bodyData-active.png",text:"Insights",pagePath:"pages/healthApp/healthDataInsights/healthDataInsights",customIcon:!1},{iconPath:"../../../static/image/navBar/home.png",selectedIconPath:"../../../static/image/navBar/home-active.png",pagePath:"pages/healthApp/home/home",text:"Daily",midButton:!0,customIcon:!1},{iconPath:"../../../static/image/navBar/healthBehave.png",selectedIconPath:"../../../static/image/navBar/healthBehave-active.png",text:"SelfCare",pagePath:"pages/healthApp/SelfCareCourse/SelfCareCourse",customIcon:!1},{iconPath:"../../../static/image/navBar/vrCare.png",selectedIconPath:"../../../static/image/navBar/vrCare-active.png",text:"VRCure",pagePath:"pages/healthApp/VRCure/VRCure",customIcon:!1}]),(0,r.default)(e,"midButton",!0),(0,r.default)(e,"inactiveColor","#9C9EB9"),(0,r.default)(e,"activeColor","#FE8787"),(0,r.default)(e,"tabList",[{name:"物品"},{name:"景色"},{name:"记忆"}]),(0,r.default)(e,"current",0),(0,r.default)(e,"swiperCurrent",0),(0,r.default)(e,"tabsHeight",0),(0,r.default)(e,"dx",0),(0,r.default)(e,"loadStatus",["loadmore","loadmore","loadmore","loadmore"]),(0,r.default)(e,"title","VR游戏疗愈定制"),(0,r.default)(e,"backText",""),(0,r.default)(e,"backIconName",""),(0,r.default)(e,"right",!1),(0,r.default)(e,"showAction",!1),(0,r.default)(e,"rightSlot",!1),(0,r.default)(e,"useSlot",!1),(0,r.default)(e,"background",{"background-image":"rgba(0,0,0,0)"}),(0,r.default)(e,"isBack",!0),(0,r.default)(e,"search",!1),(0,r.default)(e,"custom",!1),(0,r.default)(e,"isFixed",!0),(0,r.default)(e,"keyword",""),(0,r.default)(e,"slotRight",!1),(0,r.default)(e,"slotRight",!0),e},computed:{},methods:{uploadModelsSequentially:function(){var t=this;if(this.downloadedFilePaths.length===this.preUploadImgUrls.length){e.showLoading({title:"最后上传模型文件至云服务器中~"});var n=0,a=function a(){if(n<t.downloadedFilePaths.length){var o=t.downloadedFilePaths[n],s=t.preUploadImgUrls[n],i=s.split("/"),r=(i[i.length-1].split(".")[0],"".concat(t.userPhoneNum,"/tangible/pic_").concat(n+1,".fbx"));t.uploadModelFBX(o,r),n++,setTimeout(a,1e3)}else e.hideLoading(),e.showToast({title:"恭喜您！物品记忆已定制结束！！",icon:"success",duration:3e3})};a()}else console.log("Not all models have been downloaded yet.")},uploadModelFBX:function(t,n){a.uploadFile({filePath:t,cloudPath:n,cloudPathAsRealPath:!0,onUploadProgress:function(e){var t=Math.round(100*e.loaded/e.total);console.log("Upload progress: ".concat(t,"%"))},success:function(t){console.log("Upload success:",t),e.showToast({title:"上传模型成功",icon:"success",duration:1e3})},fail:function(t){console.error("Upload fail:",t),e.showModal({content:t.errMsg,showCancel:!1})},complete:function(){}})},uploadImage:function(t){var n=this;return new Promise((function(a,o){e.request({url:n.baseUrl,method:"POST",header:{Authorization:"Bearer "+n.meshyAPI,"Content-Type":"application/json"},data:{image_url:t,enable_pbr:!0}}).then((function(t){202==t[1].statusCode?(a(t[1].data.result),e.showToast({title:"请求成功",icon:"success",duration:1e3})):o(new Error("没有收到预期的响应数据"))})).catch((function(t){console.error("request fail",t),o(t),e.showModal({content:t.errMsg||"上传失败",showCancel:!1})}))}))},uploadImages:function(){var t=this;if(this.meshyLoading=!0,e.showLoading({title:"定制中~"}),this.resultIDs=[],!this.preUploadImgUrls||0===this.preUploadImgUrls.length)return console.error("No image URLs found to upload."),e.hideLoading(),void(this.meshyLoading=!1);this.preUploadImgUrls.forEach((function(n,a){t.uploadImage(n).then((function(n){t.resultIDs.push(n),console.log("Uploaded image with resultID:",n),a===t.preUploadImgUrls.length-1&&(e.hideLoading(),t.meshyLoading=!1,console.log("All images uploaded, resultIDs:",t.resultIDs),console.log("resultIDS",t.resultIDs),t.getResultAndDownloadModel())})).catch((function(n){console.error("Upload failed at index:",a,"error:",n),t.meshyLoading=!1,e.hideLoading()}))}))},getResultAndDownloadModel:function(){var t=this;e.showLoading({title:"查询定制并下载中~"});var n=function n(a,o){e.request({url:"".concat(t.baseUrl,"/").concat(a),method:"GET",header:{Authorization:"Bearer msy_ar8y9bKmstdLwmebSabtqBqnxbiZvsYLyIcX"}}).then((function(e){console.log("request success",e[1]),e[1].data&&void 0!==e[1].data.progress?100===e[1].data.progress?t.downloadModel(e[1].data,o):setTimeout((function(){n(a,o)}),1e4):console.error("返回的数据中没有progress字段")})).catch((function(e){console.error("request fail",e)}))};this.resultIDs.forEach((function(e,t){n(e,t)}))},downloadModel:function(t,n){var a=this;e.showLoading({title:"下载中"}),e.downloadFile({url:t.model_urls.fbx,success:function(t){e.showToast({title:"下载AI生成模型成功",icon:"success",duration:1e3}),console.log("下载AI生成模型成功",t),a.downloadedFilePaths[n]=t.tempFilePath,a.downloadedFilePaths.length===a.preUploadImgUrls.length&&a.uploadModelsSequentially()},fail:function(e){console.error("下载AI生成模型失败",e)}}),e.hideLoading()},inputDialogToggle:function(){this.$refs.inputDialog.open()},dialogInputConfirm:function(t){e.hideLoading(),console.log(t),this.userPhoneNum=t,this.$refs.inputDialog.close(),e.showToast({title:"登录认证成功！",icon:"success",duration:1e3}),this.hasUserInfo=!0,console.log("userPhoneNum",this.userPhoneNum)},sourceTypeChange:function(e){this.sourceTypeIndex=parseInt(e.detail.value)},sizeTypeChange:function(e){this.sizeTypeIndex=parseInt(e.detail.value)},countChange:function(e){this.countIndex=e.detail.value},chooseImage3:function(){var t=(0,i.default)(s.default.mark((function t(){var n,o=this;return s.default.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(2===this.sourceTypeIndex){t.next=6;break}return t.next=3,this.checkPermission();case 3:if(n=t.sent,1===n){t.next=6;break}return t.abrupt("return");case 6:if(9!==this.imageList3.length){t.next=9;break}return e.showToast({title:"已经到达上传上限啦~",icon:"success",duration:1e3}),t.abrupt("return");case 9:e.chooseImage({sourceType:c[this.sourceTypeIndex],sizeType:u[this.sizeTypeIndex],count:this.imageList3.length+this.count[this.countIndex]>9?9-this.imageList3.length:this.count[this.countIndex],success:function(t){o.imageList3=o.imageList3.concat(t.tempFilePaths);var n=t.tempFilePaths[0],s="".concat(o.userPhoneNum,"/normal/pic_").concat(o.normalPicsIndex++,".jpg");console.log(s),a.uploadFile({filePath:n,cloudPath:s,cloudPathAsRealPath:!0,onUploadProgress:function(e){console.log(e);Math.round(100*e.loaded/e.total)},success:function(t){console.log(t.fileID),e.showToast({title:"上传成功",icon:"success",duration:1e3})},fail:function(t){console.log("uploadImage fail",t),e.showModal({content:t.errMsg,showCancel:!1})},complete:function(){}})},fail:function(t){console.log("err: ",t),t["code"]&&0!==t.code&&2===o.sourceTypeIndex&&o.checkPermission(t.code),"-1"===t.errMsg.indexOf("cancel")&&e.getSetting({success:function(t){var n=!1;switch(o.sourceTypeIndex){case 0:n=t.authSetting["scope.camera"];break;case 1:n=t.authSetting["scope.album"];break;case 2:n=t.authSetting["scope.album"]&&t.authSetting["scope.camera"];break;default:break}n||e.showModal({title:"授权失败",content:"Hello uni-app需要从您的相机或相册获取图片，请在设置界面打开相关权限",success:function(t){t.confirm&&e.openSetting()}})}})}});case 10:case"end":return t.stop()}}),t,this)})));function n(){return t.apply(this,arguments)}return n}(),chooseImage2:function(){var t=(0,i.default)(s.default.mark((function t(){var n,o=this;return s.default.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(2===this.sourceTypeIndex){t.next=6;break}return t.next=3,this.checkPermission();case 3:if(n=t.sent,1===n){t.next=6;break}return t.abrupt("return");case 6:if(9!==this.imageList2.length){t.next=9;break}return e.showToast({title:"已经到达上传上限啦~",icon:"success",duration:1e3}),t.abrupt("return");case 9:e.chooseImage({sourceType:c[this.sourceTypeIndex],sizeType:u[this.sizeTypeIndex],count:this.imageList2.length+this.count[this.countIndex]>9?9-this.imageList2.length:this.count[this.countIndex],success:function(t){o.imageList2=o.imageList2.concat(t.tempFilePaths);var n=t.tempFilePaths[0],s="".concat(o.userPhoneNum,"/env/pic_").concat(o.envPicsIndex++,".jpg");console.log(s),a.uploadFile({filePath:n,cloudPath:s,cloudPathAsRealPath:!0,onUploadProgress:function(e){console.log(e);Math.round(100*e.loaded/e.total)},success:function(t){console.log(t.fileID),e.showToast({title:"上传成功",icon:"success",duration:1e3})},fail:function(t){console.log("uploadImage fail",t),e.showModal({content:t.errMsg,showCancel:!1})},complete:function(){}})},fail:function(t){console.log("err: ",t),t["code"]&&0!==t.code&&2===o.sourceTypeIndex&&o.checkPermission(t.code),"-1"===t.errMsg.indexOf("cancel")&&e.getSetting({success:function(t){var n=!1;switch(o.sourceTypeIndex){case 0:n=t.authSetting["scope.camera"];break;case 1:n=t.authSetting["scope.album"];break;case 2:n=t.authSetting["scope.album"]&&t.authSetting["scope.camera"];break;default:break}n||e.showModal({title:"授权失败",content:"Hello uni-app需要从您的相机或相册获取图片，请在设置界面打开相关权限",success:function(t){t.confirm&&e.openSetting()}})}})}});case 10:case"end":return t.stop()}}),t,this)})));function n(){return t.apply(this,arguments)}return n}(),chooseImage:function(){var t=(0,i.default)(s.default.mark((function t(){var n,o=this;return s.default.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(2===this.sourceTypeIndex){t.next=6;break}return t.next=3,this.checkPermission();case 3:if(n=t.sent,1===n){t.next=6;break}return t.abrupt("return");case 6:if(9!==this.imageList.length){t.next=9;break}return e.showToast({title:"已经到达上传上限啦~",icon:"success",duration:1e3}),t.abrupt("return");case 9:e.chooseImage({sourceType:c[this.sourceTypeIndex],sizeType:u[this.sizeTypeIndex],count:this.imageList.length+this.count[this.countIndex]>9?9-this.imageList.length:this.count[this.countIndex],success:function(t){o.imageList=o.imageList.concat(t.tempFilePaths);var n=t.tempFilePaths[0],s="".concat(o.userPhoneNum,"/tangible/pic_").concat(o.tangiblePicsIndex++,".jpg");console.log(s),a.uploadFile({filePath:n,cloudPath:s,cloudPathAsRealPath:!0,onUploadProgress:function(e){console.log(e);Math.round(100*e.loaded/e.total)},success:function(t){console.log(t.fileID),o.preUploadImgUrls.push(t.fileID),e.showToast({title:"上传成功",icon:"success",duration:1e3})},fail:function(t){console.log("uploadImage fail",t),e.showModal({content:t.errMsg,showCancel:!1})},complete:function(){}})},fail:function(t){console.log("err: ",t),t["code"]&&0!==t.code&&2===o.sourceTypeIndex&&o.checkPermission(t.code),"-1"===t.errMsg.indexOf("cancel")&&e.getSetting({success:function(t){var n=!1;switch(o.sourceTypeIndex){case 0:n=t.authSetting["scope.camera"];break;case 1:n=t.authSetting["scope.album"];break;case 2:n=t.authSetting["scope.album"]&&t.authSetting["scope.camera"];break;default:break}n||e.showModal({title:"授权失败",content:"Hello uni-app需要从您的相机或相册获取图片，请在设置界面打开相关权限",success:function(t){t.confirm&&e.openSetting()}})}})}});case 10:case"end":return t.stop()}}),t,this)})));function n(){return t.apply(this,arguments)}return n}(),previewImage:function(t){var n=t.target.dataset.src;e.previewImage({current:n,urls:this.imageList})},previewImage2:function(t){var n=t.target.dataset.src;e.previewImage({current:n,urls:this.imageList2})},previewImage3:function(t){var n=t.target.dataset.src;e.previewImage({current:n,urls:this.imageList3})},checkPermission:function(t){var n=this;return(0,i.default)(s.default.mark((function a(){var o,i;return s.default.wrap((function(a){while(1)switch(a.prev=a.next){case 0:if(o=t?t-1:n.sourceTypeIndex,!permision.isIOS){a.next=7;break}return a.next=4,permision.requestIOS(c[o][0]);case 4:a.t0=a.sent,a.next=10;break;case 7:return a.next=9,permision.requestAndroid(0===o?"android.permission.CAMERA":"android.permission.READ_EXTERNAL_STORAGE");case 9:a.t0=a.sent;case 10:return i=a.t0,null===i||1===i?i=1:e.showModal({content:"没有开启权限",confirmText:"设置",success:function(e){e.confirm&&permision.gotoAppSetting()}}),a.abrupt("return",i);case 13:case"end":return a.stop()}}),a)})))()},ChangBar:function(t){e.switchTab({url:"/"+this.list[t].pagePath})},remove:function(e){this.$refs.uWaterfall.remove(e)},clear:function(){this.$refs.uWaterfall.clear()},change:function(e){this.swiperCurrent=e},transition:function(e){var t=e.detail.dx;this.$refs.tabs.setDx(t)},animationfinish:function(e){var t=e.detail.current;this.$refs.tabs.setFinishCurrent(t),this.swiperCurrent=t,this.current=t},titleChange:function(e){this.useSlot=!1,this.title=0==e?"新闻":1==e?"新闻列表":"雨打梨花深闭门，忘了青春，误了青春"},leftChange:function(e){0==e?(this.backText="",this.backIconName="arrow-leftward"):(this.backText="返回",this.backIconName="arrow-left")},searchChange:function(e){},backChange:function(e){this.isBack=!!e},bgColorChange:function(e){if(this.background={},0==e)this.background={"background-image":"linear-gradient(45deg, rgb(28, 187, 180), rgb(141, 198, 63))"};else{var t=1==e?"#39CCCC":2==e?"#B471CC":"#001f3f";this.background={background:t}}},rightChange:function(e){0==e?(this.slotRight=!0,this.useSlot=!1):this.slotRight=!1},customChange:function(e){this.search=!1,this.rightSlot=!1,0==e?(this.custom=!0,this.title=null,this.isBack=!1,this.useSlot=!0):(this.useSlot=!1,this.title="新闻",this.isBack=!0)}}};t.default=l}).call(this,n(2)["default"],n(28)["default"])},124:function(e,t,n){"use strict";n.r(t);var a=n(125),o=n.n(a);for(var s in a)["default"].indexOf(s)<0&&function(e){n.d(t,e,(function(){return a[e]}))}(s);t["default"]=o.a},125:function(e,t,n){},126:function(e,t,n){"use strict";n.r(t);var a=n(127),o=n.n(a);for(var s in a)["default"].indexOf(s)<0&&function(e){n.d(t,e,(function(){return a[e]}))}(s);t["default"]=o.a},127:function(e,t,n){}},[[118,"common/runtime","common/vendor"]]]);
//# sourceMappingURL=../../../../.sourcemap/mp-weixin/pages/healthApp/VRCure/VRCure.js.map